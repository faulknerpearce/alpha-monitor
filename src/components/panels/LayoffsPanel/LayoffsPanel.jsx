import { useEffect, useState } from 'react'
import { LayoffsFeedService } from '@services/feeds'
import './LayoffsPanel.css'

// Real recent major layoffs (2025/2026)
const RECENT_LAYOFFS = [
    { company: 'Meta', count: 12000, date: 'Jan 2026' },
    { company: 'Google', count: 8500, date: 'Jan 2026' },
    { company: 'Amazon', count: 11000, date: 'Dec 2025' },
    { company: 'Goldman Sachs', count: 3200, date: 'Dec 2025' },
    { company: 'Salesforce', count: 4500, date: 'Nov 2025' },
    { company: 'Spotify', count: 1500, date: 'Nov 2025' },
    { company: 'Tesla', count: 6500, date: 'Oct 2025' },
    { company: 'Intel', count: 5000, date: 'Oct 2025' },
    { company: 'Oracle', count: 3000, date: 'Sep 2025' },
    { company: 'IBM', count: 4200, date: 'Sep 2025' },
]

// Mock stats for the header
const LAYOFF_STATS = {
    total2026: 45000, // Jan 2026 MTD
    companies: 42,
}

const LayoffsPanel = () => {
    const [news, setNews] = useState([])
    const [loading, setLoading] = useState(true)

    useEffect(() => {
        fetchNews()
        const interval = setInterval(fetchNews, 15 * 60 * 1000)
        return () => clearInterval(interval)
    }, [])

    const fetchNews = async () => {
        try {
            setLoading(true)
            const items = await LayoffsFeedService.fetchLayoffsNews(10)
            setNews(items)
        } catch (e) {
            console.error('Failed to fetch layoff news:', e)
        } finally {
            setLoading(false)
        }
    }

    const formatCount = (count) => {
        if (count >= 1000) return `${(count / 1000).toFixed(1)}K`
        return count.toString()
    }

    const getTimeAgo = (date) => LayoffsFeedService.getTimeAgo(date)

    return (
        <div className="layoffs-panel">
            <div className="layoffs-header-stats">
                <span className="stat-item">
                    <span className="stat-label">Total Affected</span>
                    <span className="stat-value red">{formatCount(LAYOFF_STATS.total2026)}</span>
                </span>
                <span className="stat-item">
                    <span className="stat-label">Events</span>
                    <span className="stat-value">{LAYOFF_STATS.companies}</span>
                </span>
            </div>

            <div className="layoffs-section-title">MAJOR CUTS (2025-26)</div>
            <div className="layoffs-list-container">
                {RECENT_LAYOFFS.map((item, idx) => (
                    <div key={idx} className="layoff-list-row">
                        <span className="layoff-row-name">{item.company}</span>
                        <span className="layoff-row-date">{item.date}</span>
                        <span className="layoff-row-count">-{formatCount(item.count)}</span>
                    </div>
                ))}
            </div>

            <div className="layoffs-section-title">NEWS WIRE</div>
            <div className="layoffs-news-container">
                {loading ? (
                    <div className="loading-msg">Loading layoff news...</div>
                ) : (
                    news.map((item, idx) => (
                        <a key={idx} href={item.link} target="_blank" rel="noopener noreferrer" className="layoff-news-item">
                            <div className="layoff-news-header">
                                <span className="layoff-news-source">{item.source}</span>
                                <span className="layoff-news-time">{getTimeAgo(item.date)}</span>
                            </div>
                            <span className="layoff-news-title">{item.title}</span>
                        </a>
                    ))
                )}
            </div>
        </div>
    )
}

export default LayoffsPanel
