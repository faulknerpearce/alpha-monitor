import { useEffect, useState } from 'react'
import { VCFeedService } from '@services'
import './VCPanel.css'

// Recent major VC fund raises (2025/2026)
const RECENT_FUNDS = [
    { firm: 'Andreessen Horowitz', fund: 'Crypto Fund V', amount: 4500, date: 'Jan 2026' },
    { firm: 'Sequoia Capital', fund: 'Growth Fund X', amount: 3200, date: 'Jan 2026' },
    { firm: 'Founders Fund', fund: 'Fund IX', amount: 1800, date: 'Dec 2025' },
    { firm: 'Insight Partners', fund: 'Fund XIII', amount: 12500, date: 'Dec 2025' },
    { firm: 'Lightspeed', fund: 'Global Opportunity II', amount: 6200, date: 'Nov 2025' },
    { firm: 'Paradigm', fund: 'Paradigm Two', amount: 2500, date: 'Nov 2025' },
    { firm: 'Accel', fund: 'Global Growth VII', amount: 4000, date: 'Oct 2025' },
    { firm: 'Index Ventures', fund: 'Growth VI', amount: 2800, date: 'Oct 2025' },
    { firm: 'Khosla Ventures', fund: 'Main Fund IX', amount: 1800, date: 'Sep 2025' },
    { firm: 'Greycroft', fund: 'Core Fund VII', amount: 950, date: 'Aug 2025' },
]

const VC_STATS = {
    totalRaised: 40250, // Total capital raised by VCs
    funds: 42, // Number of funds closed
}

const VCPanel = () => {
    const [vcNews, setVcNews] = useState([])
    const [loading, setLoading] = useState(true)

    useEffect(() => {
        loadData()
        const interval = setInterval(loadData, 10 * 60 * 1000)
        return () => clearInterval(interval)
    }, [])

    const loadData = async () => {
        setLoading(true)
        try {
            const newsItems = await VCFeedService.fetchVCNews(10)
            setVcNews(newsItems)
        } catch (e) {
            console.error('Failed to fetch VC news:', e)
        } finally {
            setLoading(false)
        }
    }

    const formatAmount = (amount) => {
        if (amount >= 1000) return `$${(amount / 1000).toFixed(1)}B`
        return `$${amount}M`
    }

    const getTimeAgo = (date) => VCFeedService.getTimeAgo(date)

    return (
        <div className="vc-panel">
            <div className="vc-header-stats">
                <div className="stat-item">
                    <span className="stat-label">Capital Raised</span>
                    <span className="stat-value purple">{formatAmount(VC_STATS.totalRaised)}</span>
                </div>
                <div className="stat-item">
                    <span className="stat-label">Funds Closed</span>
                    <span className="stat-value">{VC_STATS.funds}</span>
                </div>
            </div>

            <div className="vc-section-title">RECENT FUNDS (2025-26)</div>
            <div className="vc-list-container">
                {RECENT_FUNDS.map((item, idx) => (
                    <div key={idx} className="vc-list-row">
                        <div className="vc-row-main">
                            <span className="vc-row-name">{item.firm}</span>
                            <span className="vc-row-round">{item.fund}</span>
                        </div>
                        <div className="vc-row-meta">
                            <span className="vc-row-date">{item.date}</span>
                            <span className="vc-row-amount green">+{formatAmount(item.amount)}</span>
                        </div>
                    </div>
                ))}
            </div>

            <div className="vc-section-title">NEWS WIRE</div>
            <div className="vc-news-container">
                {loading && vcNews.length === 0 ? (
                    <div className="loading-msg">Loading VC news...</div>
                ) : (
                    vcNews.map((news, idx) => (
                        <a key={idx} href={news.link} target="_blank" rel="noopener noreferrer" className="vc-news-item">
                            <div className="vc-news-header">
                                <span className="vc-news-source">{news.source}</span>
                                <span className="vc-news-time">{getTimeAgo(news.date)}</span>
                            </div>
                            <span className="vc-news-title">{news.title}</span>
                        </a>
                    ))
                )}
            </div>
        </div>
    )
}

export default VCPanel

